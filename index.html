<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple Chat â€” Demo</title>
  <style>
    :root{--accent:#2563eb;--bg:#f3f4f6;--card:#ffffff}
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:#0f172a;margin:0;background:var(--bg);display:flex;align-items:center;justify-content:center;height:100vh}
    .app{width:100%;max-width:900px;height:90vh;background:linear-gradient(180deg,#ffffff,#fbfdff);border-radius:12px;box-shadow:0 8px 24px rgba(2,6,23,0.08);display:grid;grid-template-columns:280px 1fr;overflow:hidden}
    .sidebar{background:var(--card);border-right:1px solid #e6edf7;padding:16px;display:flex;flex-direction:column;gap:12px}
    .title{font-weight:700;margin-bottom:8px}
    .users{flex:1;overflow:auto;display:flex;flex-direction:column;gap:8px}
    .user{padding:8px;border-radius:8px;display:flex;gap:10px;align-items:center;cursor:pointer}
    .user.active{background:#eef6ff}
    .avatar{width:40px;height:40px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;background:#e2e8f0;font-weight:700}
    .main{display:flex;flex-direction:column}
    .chat-header{padding:16px;border-bottom:1px solid #eef2f6;background:linear-gradient(90deg,rgba(255,255,255,0.7),transparent);display:flex;gap:12px;align-items:center}
    .messages{flex:1;overflow:auto;padding:20px;display:flex;flex-direction:column;gap:12px;background:linear-gradient(180deg,transparent,rgba(240,249,255,0.6))}
    .msg{max-width:70%;padding:10px 12px;border-radius:12px;background:#fff;border:1px solid #eef2f6;box-shadow:0 1px 0 rgba(2,6,23,0.02)}
    .msg.me{margin-left:auto;background:#e8f0ff;border-color:#dbeafe}
    .meta{font-size:12px;color:#64748b;margin-bottom:6px}
    .composer{padding:12px;border-top:1px solid #eef2f6;background:var(--card);display:flex;gap:8px;align-items:center}
    .composer input{flex:1;padding:10px 12px;border-radius:999px;border:1px solid #e6eef9}
    .composer button{padding:10px 14px;border-radius:10px;border:0;background:var(--accent);color:white;font-weight:600}
    .small{font-size:12px;color:#94a3b8}
    @media (max-width:720px){.app{grid-template-columns:1fr; height:100vh}.sidebar{display:none}}
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div>
        <div class="title">Simple Chat Demo</div>
        <div class="small">Local-only; stores messages in localStorage</div>
      </div>
      <div style="display:flex;gap:8px">
        <input id="username" placeholder="Your name" style="flex:1;padding:8px;border-radius:8px;border:1px solid #e6eef9" />
        <button id="setName" style="padding:8px;border-radius:8px">Set</button>
      </div>
      <div class="users" id="userList"></div>
      <div style="display:flex;gap:8px">
        <button id="newConv" class="small">+ New</button>
        <button id="clearAll" class="small">Clear</button>
      </div>
    </aside>

    <section class="main">
      <div class="chat-header" id="chatHeader">
        <div class="avatar" id="chatAvatar">G</div>
        <div>
          <div id="chatTitle" style="font-weight:700">Welcome</div>
          <div class="small" id="chatSubtitle">Select or create a conversation</div>
        </div>
      </div>

      <div class="messages" id="messages"></div>

      <div class="composer">
        <input id="textInput" placeholder="Type a message and press Enter" />
        <button id="sendBtn">Send</button>
      </div>
    </section>
  </div>

  <script>
    // Simple local-only chat demo. Conversations stored in localStorage under 'simple_chat_convs'
    const userListEl = document.getElementById('userList');
    const messagesEl = document.getElementById('messages');
    const chatTitle = document.getElementById('chatTitle');
    const chatSubtitle = document.getElementById('chatSubtitle');
    const chatAvatar = document.getElementById('chatAvatar');
    const usernameInput = document.getElementById('username');

    let state = { me: localStorage.getItem('simple_chat_name') || 'You', convs: {}, activeConv: null };

    function save(){ localStorage.setItem('simple_chat_convs', JSON.stringify(state.convs)); localStorage.setItem('simple_chat_name', state.me); }
    function load(){ try{ const raw = localStorage.getItem('simple_chat_convs'); if(raw) state.convs = JSON.parse(raw); }catch(e){} }

    function createConv(name){ const id = 'conv_' + Date.now(); state.convs[id] = { id, name, messages: [] }; state.activeConv = id; save(); render(); }
    function addMessage(convId, author, text){ if(!text) return; const ts = new Date().toISOString(); state.convs[convId].messages.push({author,text,ts}); save(); renderMessages(); scrollToBottom(); }

    function renderUserList(){ userListEl.innerHTML = ''; Object.values(state.convs).forEach(conv => {
      const el = document.createElement('div'); el.className='user' + (state.activeConv===conv.id? ' active':'');
      el.innerHTML = `<div class="avatar">${conv.name.charAt(0)||'C'}</div><div style="flex:1"><div style="font-weight:600">${conv.name}</div><div class="small">${conv.messages.length} message(s)</div></div>`;
      el.onclick = ()=>{ state.activeConv = conv.id; render(); };
      userListEl.appendChild(el);
    });
    }

    function renderMessages(){ messagesEl.innerHTML = '';
      if(!state.activeConv){ messagesEl.innerHTML = '<div class="small">No conversation selected. Create a new one or pick from the left.</div>'; return; }
      const conv = state.convs[state.activeConv];
      conv.messages.forEach(m => {
        const el = document.createElement('div'); el.className = 'msg ' + (m.author===state.me? 'me':'');
        el.innerHTML = `<div class="meta">${m.author} â€¢ ${new Date(m.ts).toLocaleString()}</div><div>${escapeHtml(m.text)}</div>`;
        messagesEl.appendChild(el);
      });
    }

    function render(){ renderUserList(); renderHeader(); renderMessages(); }

    function renderHeader(){ if(!state.activeConv){ chatTitle.textContent='Welcome'; chatSubtitle.textContent='Select or create a conversation'; chatAvatar.textContent='G'; return; }
      const conv = state.convs[state.activeConv]; chatTitle.textContent = conv.name; chatSubtitle.textContent = conv.messages.length + ' message(s)'; chatAvatar.textContent = conv.name.charAt(0).toUpperCase(); }

    function escapeHtml(s){ return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

    function scrollToBottom(){ setTimeout(()=>{ messagesEl.scrollTop = messagesEl.scrollHeight; },50); }

    // UI handlers
    document.getElementById('newConv').addEventListener('click', ()=>{
      const name = prompt('Conversation name') || 'Conversation ' + (Object.keys(state.convs).length+1);
      createConv(name);
      document.getElementById('textInput').focus();
    });

    document.getElementById('clearAll').addEventListener('click', ()=>{
      if(confirm('Clear all conversations and messages?')){ state.convs={}; state.activeConv=null; save(); render(); }
    });

    document.getElementById('setName').addEventListener('click', ()=>{ const name = usernameInput.value.trim(); if(!name) return alert('Enter a name'); state.me = name; save(); render(); });

    document.getElementById('sendBtn').addEventListener('click', ()=>{ sendMessage(); });
    document.getElementById('textInput').addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); sendMessage(); } });

    function sendMessage(){ const input = document.getElementById('textInput'); const text = input.value.trim(); if(!text) return; if(!state.activeConv){ createConv('Conversation ' + (Object.keys(state.convs).length+1)); }
      addMessage(state.activeConv, state.me, text); input.value=''; // demo: optional auto-reply
      setTimeout(()=>{ autoReply(state.activeConv); }, 600);
    }

    function autoReply(convId){ const replies = ['Nice!', 'Got it.', 'Thanks for sharing.', 'Haha ðŸ˜„', 'I will check and reply.']; const pick = replies[Math.floor(Math.random()*replies.length)]; addMessage(convId, 'Guest', pick); }

    // init
    load(); if(!Object.keys(state.convs).length){ createConv('General'); }
    render(); document.getElementById('textInput').focus();
  </script>
</body>
</html>
